<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="POS_in_NET.Pages.OrderPlacementPage"
             Title="Order Placement"
             BackgroundColor="#F8FAFC">

    <Grid>
        <!-- Main Content -->
        <Grid ColumnDefinitions="2*,*" ColumnSpacing="15" Padding="15">
            
            <!-- LEFT SIDE - Menu Selection -->
            <Border Grid.Column="0" 
                    BackgroundColor="White" 
                    StrokeThickness="0"
                    Padding="0"
                    Shadow="{StaticResource CardShadow}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                
                <Grid RowDefinitions="Auto,Auto,Auto,*" RowSpacing="0">
                    
                    <!-- Search Bar -->
                    <Border Grid.Row="0" 
                            BackgroundColor="#F1F5F9"
                            Padding="15"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12,12,0,0"/>
                        </Border.StrokeShape>
                        <Frame BackgroundColor="White" 
                               BorderColor="#E2E8F0" 
                               CornerRadius="8" 
                               Padding="12,8"
                               HasShadow="False">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <Label Grid.Column="0" 
                                       Text="ðŸ”" 
                                       FontSize="18" 
                                       VerticalOptions="Center"
                                       Margin="0,0,8,0"/>
                                <Entry Grid.Column="1"
                                       x:Name="SearchEntry"
                                       Placeholder="Search items..."
                                       BackgroundColor="Transparent"
                                       TextColor="#1E293B"
                                       PlaceholderColor="#94A3B8"
                                       VerticalOptions="Center"
                                       TextChanged="OnSearchTextChanged"/>
                                <Button Grid.Column="2"
                                        Text="âœ•"
                                        BackgroundColor="Transparent"
                                        TextColor="#94A3B8"
                                        FontSize="16"
                                        Padding="8,0"
                                        IsVisible="False"
                                        x:Name="ClearSearchButton"
                                        Clicked="OnClearSearchClicked"/>
                            </Grid>
                        </Frame>
                    </Border>

                    <!-- Categories (2 rows x 6 columns, horizontal scroll) -->
                    <Grid Grid.Row="1" 
                          RowDefinitions="Auto,Auto" 
                          RowSpacing="10"
                          Padding="15,15,15,0"
                          BackgroundColor="#F8FAFC">
                        
                        <!-- Row 1 -->
                        <ScrollView Grid.Row="0" 
                                    Orientation="Horizontal" 
                                    HorizontalScrollBarVisibility="Never">
                            <FlexLayout x:Name="CategoryRow1" 
                                        Direction="Row" 
                                        JustifyContent="Start" 
                                        Wrap="NoWrap"/>
                        </ScrollView>

                        <!-- Row 2 -->
                        <ScrollView Grid.Row="1" 
                                    Orientation="Horizontal" 
                                    HorizontalScrollBarVisibility="Never">
                            <FlexLayout x:Name="CategoryRow2" 
                                        Direction="Row" 
                                        JustifyContent="Start" 
                                        Wrap="NoWrap"/>
                        </ScrollView>
                    </Grid>

                    <!-- Sub-Categories (2 rows x 6 columns, horizontal scroll) -->
                    <Grid Grid.Row="2" 
                          x:Name="SubCategorySection"
                          RowDefinitions="Auto,Auto" 
                          RowSpacing="10"
                          Padding="15,10,15,10"
                          BackgroundColor="White"
                          IsVisible="False">
                        
                        <!-- Row 1 -->
                        <ScrollView Grid.Row="0" 
                                    Orientation="Horizontal" 
                                    HorizontalScrollBarVisibility="Never">
                            <FlexLayout x:Name="SubCategoryRow1" 
                                        Direction="Row" 
                                        JustifyContent="Start" 
                                        Wrap="NoWrap"/>
                        </ScrollView>

                        <!-- Row 2 -->
                        <ScrollView Grid.Row="1" 
                                    Orientation="Horizontal" 
                                    HorizontalScrollBarVisibility="Never">
                            <FlexLayout x:Name="SubCategoryRow2" 
                                        Direction="Row" 
                                        JustifyContent="Start" 
                                        Wrap="NoWrap"/>
                        </ScrollView>
                    </Grid>

                    <!-- Items Grid (vertical scroll) -->
                    <ScrollView Grid.Row="3" 
                                Padding="15"
                                BackgroundColor="White">
                        <FlexLayout x:Name="ItemsGrid" 
                                    Direction="Row" 
                                    Wrap="Wrap" 
                                    JustifyContent="Start"
                                    AlignContent="Start"/>
                    </ScrollView>

                </Grid>
            </Border>

            <!-- RIGHT SIDE - Order Panel -->
            <Border Grid.Column="1" 
                    BackgroundColor="White" 
                    StrokeThickness="0"
                    Padding="0"
                    Shadow="{StaticResource CardShadow}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                
                <Grid RowDefinitions="Auto,*,Auto,Auto">
                    
                    <!-- Table Header Card -->
                    <Border Grid.Row="0" 
                            BackgroundColor="#6366F1"
                            Padding="20"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12,12,0,0"/>
                        </Border.StrokeShape>
                        <Grid RowDefinitions="Auto,Auto,Auto">
                            <!-- Table Number & Staff -->
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       x:Name="TableNumberLabel"
                                       Text="TABLE 5"
                                       FontSize="28"
                                       FontAttributes="Bold"
                                       TextColor="White"
                                       VerticalOptions="Center"/>
                                <Button Grid.Column="1"
                                        Text="CHANGE"
                                        BackgroundColor="#8B5CF6"
                                        TextColor="White"
                                        FontSize="12"
                                        Padding="12,6"
                                        CornerRadius="6"
                                        Clicked="OnChangeTableClicked"/>
                            </Grid>

                            <!-- Staff & Cover Info -->
                            <Grid Grid.Row="1" 
                                  ColumnDefinitions="*,Auto" 
                                  Margin="0,10,0,0">
                                <Label Grid.Column="0"
                                       x:Name="StaffNameLabel"
                                       Text="Staff: Sarah"
                                       FontSize="14"
                                       TextColor="White"
                                       Opacity="0.9"
                                       VerticalOptions="Center"/>
                                <Label Grid.Column="1"
                                       x:Name="CoverCountLabel"
                                       Text="Cover: 3"
                                       FontSize="14"
                                       TextColor="White"
                                       Opacity="0.9"
                                       VerticalOptions="Center"/>
                            </Grid>

                            <!-- Timer -->
                            <Label Grid.Row="2"
                                   x:Name="TimerLabel"
                                   Text="â± 00:00:00"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="White"
                                   Margin="0,5,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Order Items List -->
                    <ScrollView Grid.Row="1" Padding="15">
                        <VerticalStackLayout x:Name="OrderItemsContainer" Spacing="10"/>
                    </ScrollView>

                    <!-- Price Summary -->
                    <Border Grid.Row="2" 
                            BackgroundColor="#F8FAFC"
                            Padding="20"
                            StrokeThickness="0">
                        <Grid RowDefinitions="Auto,Auto,Auto,Auto" RowSpacing="8">
                            <!-- Subtotal -->
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       Text="Subtotal:"
                                       FontSize="14"
                                       TextColor="#64748B"/>
                                <Label Grid.Column="1"
                                       x:Name="SubtotalLabel"
                                       Text="Â£0.00"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#1E293B"/>
                            </Grid>

                            <!-- Service Charge -->
                            <Grid Grid.Row="1" 
                                  x:Name="ServiceChargeRow"
                                  ColumnDefinitions="*,Auto"
                                  IsVisible="False">
                                <Label Grid.Column="0"
                                       x:Name="ServiceChargePercentLabel"
                                       Text="Service Charge (10%):"
                                       FontSize="14"
                                       TextColor="#64748B"/>
                                <Label Grid.Column="1"
                                       x:Name="ServiceChargeLabel"
                                       Text="Â£0.00"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#1E293B"/>
                            </Grid>

                            <!-- Divider -->
                            <BoxView Grid.Row="2" 
                                     HeightRequest="1" 
                                     BackgroundColor="#E2E8F0"
                                     Margin="0,8"/>

                            <!-- Total -->
                            <Grid Grid.Row="3" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0"
                                       Text="TOTAL:"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#1E293B"/>
                                <Label Grid.Column="1"
                                       x:Name="TotalLabel"
                                       Text="Â£0.00"
                                       FontSize="22"
                                       FontAttributes="Bold"
                                       TextColor="#10B981"/>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- Action Buttons -->
                    <Grid Grid.Row="3" 
                          ColumnDefinitions="*,*,*,*,*,*"
                          ColumnSpacing="5"
                          Padding="10"
                          BackgroundColor="White">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="0,0,12,12"/>
                        </Border.StrokeShape>

                        <Button Grid.Column="0"
                                Text="SERVICE"
                                BackgroundColor="#8B5CF6"
                                TextColor="White"
                                FontSize="11"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="0"
                                Clicked="OnServiceFeeClicked"/>

                        <Button Grid.Column="1"
                                Text="NOTES"
                                BackgroundColor="#0EA5E9"
                                TextColor="White"
                                FontSize="11"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="0"
                                Clicked="OnNotesClicked"/>

                        <Button Grid.Column="2"
                                Text="VOID"
                                BackgroundColor="#EF4444"
                                TextColor="White"
                                FontSize="11"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="0"
                                Clicked="OnVoidClicked"/>

                        <Button Grid.Column="3"
                                Text="MORE â–¼"
                                BackgroundColor="#64748B"
                                TextColor="White"
                                FontSize="11"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="0"
                                Clicked="OnMoreClicked"/>

                        <Button Grid.Column="4"
                                Text="SEND"
                                BackgroundColor="#F59E0B"
                                TextColor="White"
                                FontSize="11"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="0"
                                Clicked="OnSendClicked"/>

                        <Button Grid.Column="5"
                                Text="PAY"
                                BackgroundColor="#10B981"
                                TextColor="White"
                                FontSize="11"
                                FontAttributes="Bold"
                                CornerRadius="8"
                                Padding="0"
                                Clicked="OnPayClicked"/>
                    </Grid>

                </Grid>
            </Border>

        </Grid>

        <!-- Modifier Popup (initially hidden) -->
        <Border x:Name="ModifierPopupOverlay"
                BackgroundColor="#80000000"
                IsVisible="False"
                InputTransparent="False">
            <Border.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnCloseModifierPopup"/>
            </Border.GestureRecognizers>

            <Border BackgroundColor="White"
                    WidthRequest="600"
                    HeightRequest="700"
                    VerticalOptions="Center"
                    HorizontalOptions="Center"
                    Padding="0"
                    StrokeThickness="0"
                    InputTransparent="False">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnPopupContentTapped"/>
                </Border.GestureRecognizers>

                <Grid RowDefinitions="Auto,*,Auto">
                    <!-- Header -->
                    <Border Grid.Row="0"
                            BackgroundColor="#6366F1"
                            Padding="20"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16,16,0,0"/>
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="*,Auto">
                            <VerticalStackLayout Grid.Column="0">
                                <Label x:Name="ModifierItemName"
                                       Text="Item Name"
                                       FontSize="22"
                                       FontAttributes="Bold"
                                       TextColor="White"/>
                                <Label x:Name="ModifierItemBasePrice"
                                       Text="Base: Â£8.99"
                                       FontSize="14"
                                       TextColor="White"
                                       Opacity="0.9"
                                       Margin="0,4,0,0"/>
                            </VerticalStackLayout>
                            <Button Grid.Column="1"
                                    Text="âœ•"
                                    BackgroundColor="#EF4444"
                                    TextColor="White"
                                    FontSize="18"
                                    FontAttributes="Bold"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    Padding="0"
                                    Clicked="OnCloseModifierPopup"/>
                        </Grid>
                    </Border>

                    <!-- Content -->
                    <ScrollView Grid.Row="1" Padding="20">
                        <VerticalStackLayout x:Name="ModifierContent" Spacing="20"/>
                    </ScrollView>

                    <!-- Footer -->
                    <Border Grid.Row="2"
                            BackgroundColor="#F8FAFC"
                            Padding="20"
                            StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="0,0,16,16"/>
                        </Border.StrokeShape>
                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                            <Label Grid.Column="0"
                                   Text="ITEM TOTAL:"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#64748B"
                                   VerticalOptions="Center"/>
                            <Label Grid.Column="1"
                                   x:Name="ModifierTotalLabel"
                                   Text="Â£0.00"
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#10B981"
                                   VerticalOptions="Center"/>
                            <Button Grid.Column="2"
                                    Text="ADD TO ORDER"
                                    BackgroundColor="#10B981"
                                    TextColor="White"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    CornerRadius="10"
                                    Padding="30,12"
                                    Clicked="OnAddToOrderClicked"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </Border>
        </Grid>
        
        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay" 
              IsVisible="False"
              BackgroundColor="#80000000"
              ZIndex="999">
            <Border BackgroundColor="White"
                    WidthRequest="200"
                    HeightRequest="150"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    StrokeThickness="0"
                    Padding="20">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12"/>
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="15" HorizontalOptions="Center" VerticalOptions="Center">
                    <ActivityIndicator IsRunning="True"
                                     Color="#3B82F6"
                                     WidthRequest="40"
                                     HeightRequest="40"/>
                    <Label Text="Loading menu..."
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#1E293B"
                           HorizontalOptions="Center"/>
                    <Label Text="Please wait"
                           FontSize="13"
                           TextColor="#64748B"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Border>
        </Grid>
    </Grid>

    </ContentPage>
