<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:POS_in_NET.Views"
             xmlns:controls="clr-namespace:POS_in_NET.Controls"
             x:Class="POS_in_NET.Pages.PostcodeLookupPage"
             Title=""
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,Auto,*">
        
        <!-- Top Bar -->
        <views:TopBar x:Name="TopBar" Grid.Row="0"/>
        
        <!-- Toast Notification Overlay -->
        <controls:ToastNotification x:Name="ToastNotification" 
                                   Grid.RowSpan="3"
                                   ZIndex="1000"
                                   InputTransparent="True"/>
        
        <!-- Modern Tab Bar -->
        <Frame Grid.Row="1" 
               BackgroundColor="White"
               Padding="0"
               CornerRadius="0"
               HasShadow="False"
               BorderColor="#E5E7EB">
            <ScrollView Orientation="Horizontal" HorizontalScrollBarVisibility="Never" Padding="20,16">
                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                    <!-- Business Info Tab -->
                    <Border x:Name="BusinessTabBorder"
                            BackgroundColor="White"
                            StrokeThickness="1"
                            Stroke="#E5E7EB"
                            Padding="24,12"
                            MinimumWidthRequest="140"
                            HeightRequest="48">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnBusinessTabClicked"/>
                        </Border.GestureRecognizers>
                        <Label Text="Business Info" 
                               TextColor="#6B7280"
                               FontSize="14"
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"/>
                    </Border>

                    <!-- User Tab -->
                    <Border x:Name="UserTabBorder"
                            BackgroundColor="White"
                            StrokeThickness="1"
                            Stroke="#E5E7EB"
                            Padding="24,12"
                            MinimumWidthRequest="100"
                            HeightRequest="48">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnUserTabClicked"/>
                        </Border.GestureRecognizers>
                        <Label Text="User" 
                               TextColor="#6B7280"
                               FontSize="14"
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"/>
                    </Border>

                    <!-- OrderWeb Connect Tab -->
                    <Border x:Name="CloudTabBorder"
                            BackgroundColor="White"
                            StrokeThickness="1"
                            Stroke="#E5E7EB"
                            Padding="24,12"
                            MinimumWidthRequest="160"
                            HeightRequest="48">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnCloudTabClicked"/>
                        </Border.GestureRecognizers>
                        <Label Text="OrderWeb Connect" 
                               TextColor="#6B7280"
                               FontSize="14"
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"/>
                    </Border>

                    <!-- Postcode Lookup Tab (Active) -->
                    <Border x:Name="PostcodeTabBorder"
                            BackgroundColor="#FEF2F2"
                            StrokeThickness="2"
                            Stroke="#EF4444"
                            Padding="24,12"
                            MinimumWidthRequest="150"
                            HeightRequest="48">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12"/>
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow Brush="#EF4444" Radius="8" Opacity="0.2" Offset="0,2"/>
                        </Border.Shadow>
                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnPostcodeTabClicked"/>
                        </Border.GestureRecognizers>
                        <Label Text="Postcode Lookup" 
                               TextColor="#EF4444"
                               FontSize="14"
                               FontAttributes="Bold"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"/>
                    </Border>
                </HorizontalStackLayout>
            </ScrollView>
        </Frame>
        
        <!-- Main Content -->
        <ScrollView Grid.Row="2">
        <VerticalStackLayout Padding="32" Spacing="24" MaximumWidthRequest="1400" HorizontalOptions="Center">

            <!-- Header Section -->
            <VerticalStackLayout Spacing="8" Margin="0,0,0,8">
                <Label Text="Postcode Lookup Settings" 
                       FontSize="28" 
                       FontFamily="OpenSansBold"
                       TextColor="#1F2937" />
                <Label Text="Configure address lookup provider for delivery orders" 
                       FontSize="15" 
                       FontFamily="OpenSansRegular"
                       TextColor="#6B7280" />
            </VerticalStackLayout>

            <!-- Mapbox Settings -->
            <Frame x:Name="MapboxFrame" 
                   BackgroundColor="White" 
                   CornerRadius="12" 
                   Padding="24" 
                   HasShadow="False"
                   BorderColor="#E5E7EB"
                   IsVisible="True">
                <VerticalStackLayout Spacing="16">
                    
                    <Label Text="Mapbox Configuration" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="#1F2937"/>

                    <!-- API Token -->
                    <VerticalStackLayout Spacing="6">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="API Access Token" FontSize="14" FontAttributes="Bold" TextColor="#374151" VerticalOptions="Center"/>
                            <Button x:Name="ToggleMapboxTokenButton"
                                    Text="Show"
                                    FontSize="12"
                                    Padding="8,4"
                                    BackgroundColor="#E5E7EB"
                                    TextColor="#374151"
                                    CornerRadius="6"
                                    Clicked="OnToggleMapboxToken"/>
                        </HorizontalStackLayout>
                        <Entry x:Name="MapboxTokenEntry"
                               Placeholder="sk.eyJ1Ijo... or pk.eyJ1Ijo..."
                               FontSize="14"
                               IsPassword="True"
                               BackgroundColor="White"
                               TextColor="#1F2937"/>
                    </VerticalStackLayout>

                    <!-- Test Connection Button -->
                    <Button x:Name="TestMapboxButton"
                            Text="Test Connection"
                            Clicked="OnTestMapboxClicked"
                            BackgroundColor="#3B82F6"
                            TextColor="White"
                            CornerRadius="8"
                            HeightRequest="44"
                            FontSize="14"
                            FontAttributes="Bold"/>

                    <!-- Connection Status -->
                    <Frame x:Name="MapboxStatusFrame"
                           Padding="14"
                           CornerRadius="8"
                           IsVisible="False"
                           HasShadow="False"
                           BorderColor="#E5E7EB">
                        <HorizontalStackLayout Spacing="10">
                            <Label x:Name="MapboxStatusIcon" 
                                   FontSize="16" 
                                   VerticalOptions="Center"/>
                            <Label x:Name="MapboxStatusText" 
                                   FontSize="13" 
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- Usage Statistics -->
                    <Frame x:Name="MapboxStatsFrame"
                           Padding="16"
                           BackgroundColor="#F3F4F6"
                           BorderColor="#E5E7EB"
                           CornerRadius="8"
                           IsVisible="False"
                           HasShadow="False">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Usage Statistics" 
                                   FontSize="13" 
                                   FontAttributes="Bold"
                                   TextColor="#374151"/>
                            <Label x:Name="MapboxUsageLabel" 
                                   FontSize="12" 
                                   TextColor="#6B7280"/>
                            <Label x:Name="MapboxLastUsedLabel" 
                                   FontSize="11" 
                                   TextColor="#9CA3AF"/>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Custom PAF Settings -->
            <Frame x:Name="CustomFrame" 
                   BackgroundColor="White" 
                   CornerRadius="12" 
                   Padding="24" 
                   HasShadow="False"
                   BorderColor="#E5E7EB"
                   IsVisible="False">
                <VerticalStackLayout Spacing="16">
                    
                    <Label Text="Custom PAF Database" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="#1F2937"/>

                    <!-- API URL -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="API Endpoint URL" FontSize="14" FontAttributes="Bold" TextColor="#374151"/>
                        <Entry x:Name="CustomUrlEntry"
                               Placeholder="https://your-api.com"
                               FontSize="14"
                               BackgroundColor="White"
                               TextColor="#1F2937"/>
                    </VerticalStackLayout>

                    <!-- Auth Token -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Authentication Token (Optional)" FontSize="14" FontAttributes="Bold" TextColor="#374151"/>
                        <Entry x:Name="CustomTokenEntry"
                               Placeholder="Bearer token for API authentication"
                               FontSize="14"
                               IsPassword="True"
                               BackgroundColor="White"
                               TextColor="#1F2937"/>
                    </VerticalStackLayout>

                    <!-- Test Connection Button -->
                    <Button x:Name="TestCustomButton"
                            Text="Test Connection"
                            Clicked="OnTestCustomClicked"
                            BackgroundColor="#8B5CF6"
                            TextColor="White"
                            CornerRadius="8"
                            HeightRequest="44"
                            FontSize="14"
                            FontAttributes="Bold"/>

                    <!-- Connection Status -->
                    <Frame x:Name="CustomStatusFrame"
                           Padding="14"
                           CornerRadius="8"
                           IsVisible="False"
                           HasShadow="False"
                           BorderColor="#E5E7EB">
                        <HorizontalStackLayout Spacing="10">
                            <Label x:Name="CustomStatusIcon" 
                                   FontSize="16" 
                                   VerticalOptions="Center"/>
                            <Label x:Name="CustomStatusText" 
                                   FontSize="13" 
                                   VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                    </Frame>

                    <!-- Info Box -->
                    <Frame Padding="16"
                           BackgroundColor="#FEF3C7"
                           BorderColor="#F59E0B"
                           CornerRadius="8"
                           HasShadow="False">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Future Feature" 
                                   FontSize="13" 
                                   FontAttributes="Bold"
                                   TextColor="#92400E"/>
                            <Label Text="Use this when you build your own Royal Mail PAF database"
                                   FontSize="12" 
                                   TextColor="#78350F"/>
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Action Buttons -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12" Margin="0,8,0,20">
                <Button Grid.Column="0"
                        x:Name="CancelButton"
                        Text="Cancel"
                        Clicked="OnCancelClicked"
                        BackgroundColor="#6B7280"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="48"
                        FontSize="15"
                        FontAttributes="Bold"/>

                <Button Grid.Column="1"
                        x:Name="SaveButton"
                        Text="Save Settings"
                        Clicked="OnSaveClicked"
                        BackgroundColor="#10B981"
                        TextColor="White"
                        CornerRadius="8"
                        HeightRequest="48"
                        FontSize="15"
                        FontAttributes="Bold"/>
            </Grid>

            <!-- Activity Indicator -->
            <ActivityIndicator x:Name="LoadingIndicator"
                             IsRunning="False"
                             IsVisible="False"
                             Color="#3B82F6"
                             HeightRequest="40"
                             WidthRequest="40"
                             HorizontalOptions="Center"/>

        </VerticalStackLayout>
    </ScrollView>
    
    </Grid>
</ContentPage>
