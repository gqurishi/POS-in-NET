<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="POS_in_NET.Pages.WebOrdersPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:sys="clr-namespace:System;assembly=netstandard"
             xmlns:views="clr-namespace:POS_in_NET.Views"
             Title=""
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,*">
        
        <!-- Top Bar (200px) -->
        <views:TopBar x:Name="TopBar" Grid.Row="0"/>
        
        <!-- (TopBar custom content removed - Sync & connection moved to bottom) -->
        
        <!-- Main Content Grid -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

        <!-- Header Section with Elegant Colored Stats -->
        <StackLayout Grid.Row="0" BackgroundColor="#FFFFFF" Padding="30,25">

            <!-- Elegant Stats and Filter Section - Compact Design -->
            <Grid x:Name="StatsSection" Margin="0,10,0,0" ColumnSpacing="15" IsVisible="False">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- Today's Orders - Compact Card -->
                <Border Grid.Column="0" 
                        BackgroundColor="{StaticResource Blue50}"
                        StrokeThickness="0"
                        Padding="15,12">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <StackLayout Spacing="3">
                        <Label Text="TODAY'S ORDERS" 
                               FontFamily="AlegreyaBold"
                               FontSize="10"
                               TextColor="{StaticResource Blue600}" />
                        <Label x:Name="TodayOrderCountLabel" 
                               Text="0" 
                               FontFamily="AlegreyaBold"
                               TextColor="{StaticResource Blue700}" 
                               FontSize="28" />
                    </StackLayout>
                </Border>

                <!-- Date Filter - Compact Design -->
                <Border Grid.Column="1" 
                        BackgroundColor="{StaticResource Green50}"
                        StrokeThickness="0"
                        Padding="15,12">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <StackLayout Spacing="8">
                        <Label Text="FILTER BY DATE" 
                               FontFamily="AlegreyaBold"
                               FontSize="10"
                               TextColor="{StaticResource Green600}" />
                        
                        <!-- Compact Date Picker Container -->
                        <Border BackgroundColor="White"
                                StrokeThickness="2"
                                Stroke="{StaticResource Green300}"
                                Padding="10,6">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="6" />
                            </Border.StrokeShape>
                            <DatePicker x:Name="OrderDatePicker"
                                        Date="{x:Static sys:DateTime.Now}"
                                        Format="dd/MM/yyyy"
                                        TextColor="{StaticResource Green900}"
                                        BackgroundColor="Transparent"
                                        FontFamily="AlegreyaBold"
                                        FontSize="14"
                                        MinimumHeightRequest="30"
                                        DateSelected="OnDateSelected" />
                        </Border>
                        
                        <Label x:Name="SelectedDateLabel" 
                               Text="Showing: Today" 
                               FontFamily="AlegreyaRegular"
                               FontSize="10"
                               TextColor="{StaticResource Green700}"
                               HorizontalTextAlignment="Center" />
                        
                        <!-- Show All Orders Toggle -->
                        <Button x:Name="ShowAllButton"
                                Text="ðŸ“… Show All"
                                FontSize="10"
                                Padding="8,4"
                                CornerRadius="4"
                                BackgroundColor="{StaticResource Green600}"
                                TextColor="White"
                                Clicked="OnShowAllClicked" />
                    </StackLayout>
                </Border>

                <!-- Search Orders - Compact Design -->
                <Border Grid.Column="2" 
                        BackgroundColor="{StaticResource Purple50}"
                        StrokeThickness="0"
                        Padding="15,12">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <StackLayout Spacing="6">
                        <Label Text="SEARCH ORDERS" 
                               FontFamily="AlegreyaBold"
                               FontSize="10"
                               TextColor="{StaticResource Purple600}" />
                        <Entry x:Name="GlobalSearchEntry" 
                               Placeholder="Order #, Customer..." 
                               PlaceholderColor="{StaticResource Purple400}"
                               TextColor="{StaticResource Purple900}"
                               BackgroundColor="Transparent"
                               FontFamily="AlegreyaRegular"
                               FontSize="13"
                               HeightRequest="30"
                               TextChanged="OnGlobalSearchChanged" />
                    </StackLayout>
                </Border>
            </Grid>
        </StackLayout>

        <!-- Main Content -->
        <ScrollView Grid.Row="1">
            <StackLayout Padding="20">

                <!-- Access Denied Message (Staff users) -->
                <Frame x:Name="AccessDeniedFrame" 
                       BackgroundColor="#f8d7da" 
                       BorderColor="#f5c6cb" 
                       Padding="20" 
                       Margin="0,0,0,20"
                       IsVisible="False">
                    <StackLayout>
                        <Label Text="âš ï¸ Access Restricted" 
                               FontSize="18" 
                               FontAttributes="Bold" 
                               TextColor="#721c24" />
                        <Label Text="You don't have permission to view web orders. Only managers and administrators can access this feature." 
                               TextColor="#721c24" 
                               FontSize="14" 
                               Margin="0,10,0,0" />
                        <Label Text="Please contact your manager if you need access to web order management." 
                               TextColor="#721c24" 
                               FontSize="12" 
                               FontAttributes="Italic" 
                               Margin="0,5,0,0" />
                    </StackLayout>
                </Frame>

                <!-- Orders List -->
                <StackLayout x:Name="OrdersSection" IsVisible="False">
                    <Label Text="Recent Web Orders" 
                           Style="{StaticResource Heading4}"
                           Margin="0,0,0,15" />
                    
                    <!-- Table Header -->
                    <Grid BackgroundColor="{StaticResource Muted}" Padding="15,12" Margin="0,0,0,2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="130" />
                            <ColumnDefinition Width="100" />
                            <ColumnDefinition Width="110" />
                            <ColumnDefinition Width="120" />
                            <ColumnDefinition Width="150" />
                        </Grid.ColumnDefinitions>
                        
                        <Label Grid.Column="0" 
                               Text="Order ID" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="1" 
                               Text="Date" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="2" 
                               Text="Customer" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="3" 
                               Text="Type" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               HorizontalTextAlignment="Center" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="4" 
                               Text="Payment Method" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               HorizontalTextAlignment="Center" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="5" 
                               Text="Total" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               VerticalOptions="Center" 
                               Margin="10,0,0,0" />
                        <Label Grid.Column="6" 
                               Text="Status" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               HorizontalTextAlignment="Center" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="7" 
                               Text="Print Status" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               HorizontalTextAlignment="Center" 
                               VerticalOptions="Center" />
                        <Label Grid.Column="8" 
                               Text="Actions" 
                               FontFamily="AlegreyaBold"
                               FontSize="16" 
                               TextColor="{StaticResource Foreground}" 
                               HorizontalTextAlignment="Center" 
                               VerticalOptions="Center" />
                    </Grid>
                    
                    <!-- Orders CollectionView -->
                    <CollectionView x:Name="OrdersCollectionView" ItemsSource="{Binding Orders}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <!-- Table Row with Alegreya Font -->
                                <Grid Padding="15,16" BackgroundColor="{StaticResource Card}" Margin="0,0,0,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="130" />
                                        <ColumnDefinition Width="100" />
                                        <ColumnDefinition Width="110" />
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition Width="150" />
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Order ID -->
                                    <Label Grid.Column="0" 
                                           Text="{Binding OrderNumber}" 
                                           FontFamily="AlegreyaBold"
                                           FontSize="15" 
                                           TextColor="{StaticResource Primary}" 
                                           VerticalOptions="Center" />
                                    
                                    <!-- Date -->
                                    <StackLayout Grid.Column="1" VerticalOptions="Center">
                                        <Label Text="{Binding CreatedAt, StringFormat='{0:MMM dd, yyyy}'}" 
                                               FontFamily="AlegreyaRegular"
                                               FontSize="14" 
                                               TextColor="{StaticResource Foreground}" />
                                        <Label Text="{Binding CreatedAt, StringFormat='{0:HH:mm}'}" 
                                               FontFamily="AlegreyaRegular"
                                               FontSize="12" 
                                               TextColor="{StaticResource MutedForeground}" />
                                    </StackLayout>
                                    
                                    <!-- Customer -->
                                    <StackLayout Grid.Column="2" VerticalOptions="Center">
                                        <Label Text="{Binding CustomerName}" 
                                               FontFamily="AlegreyaBold"
                                               FontSize="15" 
                                               TextColor="{StaticResource Foreground}" />
                                        <Label Text="{Binding CustomerPhone}" 
                                               FontFamily="AlegreyaRegular"
                                               FontSize="13" 
                                               TextColor="{StaticResource MutedForeground}" />
                                    </StackLayout>
                                    
                                    <!-- Type (Order Type) -->
                                    <Frame Grid.Column="3" 
                                           BackgroundColor="#3b82f6" 
                                           Padding="10,6" 
                                           CornerRadius="6" 
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Margin="5,0">
                                        <Label Text="Regular" 
                                               FontFamily="AlegreyaBold"
                                               FontSize="13" 
                                               TextColor="White"
                                               HorizontalTextAlignment="Center" />
                                    </Frame>
                                    
                                    <!-- Payment Method -->
                                    <Frame Grid.Column="4" 
                                           BackgroundColor="#6b7280"
                                           Padding="10,6" 
                                           CornerRadius="6" 
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Margin="5,0">
                                        <Frame.Triggers>
                                            <DataTrigger TargetType="Frame" Binding="{Binding PaymentMethod}" Value="cash">
                                                <Setter Property="BackgroundColor" Value="#10b981" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding PaymentMethod}" Value="Cash">
                                                <Setter Property="BackgroundColor" Value="#10b981" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding PaymentMethod}" Value="card">
                                                <Setter Property="BackgroundColor" Value="#3b82f6" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding PaymentMethod}" Value="Card">
                                                <Setter Property="BackgroundColor" Value="#3b82f6" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding PaymentMethod}" Value="voucher">
                                                <Setter Property="BackgroundColor" Value="#a855f7" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Frame" Binding="{Binding PaymentMethod}" Value="gift_card">
                                                <Setter Property="BackgroundColor" Value="#a855f7" />
                                            </DataTrigger>
                                        </Frame.Triggers>
                                        <Label Text="{Binding PaymentMethod, TargetNullValue='N/A', FallbackValue='N/A'}"
                                               FontFamily="AlegreyaBold"
                                               FontSize="13" 
                                               TextColor="White"
                                               HorizontalTextAlignment="Center">
                                            <Label.Triggers>
                                                <DataTrigger TargetType="Label" Binding="{Binding PaymentMethod}" Value="cash">
                                                    <Setter Property="Text" Value="ðŸ’µ Cash" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding PaymentMethod}" Value="Cash">
                                                    <Setter Property="Text" Value="ðŸ’µ Cash" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding PaymentMethod}" Value="card">
                                                    <Setter Property="Text" Value="ðŸ’³ Card" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding PaymentMethod}" Value="Card">
                                                    <Setter Property="Text" Value="ðŸ’³ Card" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding PaymentMethod}" Value="voucher">
                                                    <Setter Property="Text" Value="ðŸŽ Gift Card" />
                                                </DataTrigger>
                                                <DataTrigger TargetType="Label" Binding="{Binding PaymentMethod}" Value="gift_card">
                                                    <Setter Property="Text" Value="ðŸŽ Gift Card" />
                                                </DataTrigger>
                                            </Label.Triggers>
                                        </Label>
                                    </Frame>
                                    
                                    <!-- Total Amount -->
                                    <Label Grid.Column="5" 
                                           Text="{Binding TotalAmount, StringFormat='Â£{0:F2}'}" 
                                           FontFamily="AlegreyaBold"
                                           FontSize="16" 
                                           TextColor="{StaticResource Green600}"
                                           VerticalOptions="Center"
                                           Margin="10,0,0,0" />
                                    
                                    <!-- Status -->
                                    <Frame Grid.Column="6" 
                                           BackgroundColor="#3b82f6" 
                                           Padding="10,6" 
                                           CornerRadius="6" 
                                           HasShadow="False"
                                           VerticalOptions="Center"
                                           HorizontalOptions="Center"
                                           Margin="5,0">
                                        <Label Text="Confirmed" 
                                               FontFamily="AlegreyaBold"
                                               FontSize="13" 
                                               TextColor="White"
                                               HorizontalTextAlignment="Center" />
                                    </Frame>
                                    
                                    <!-- Print Status -->
                                    <HorizontalStackLayout Grid.Column="7" 
                                                          Spacing="6"
                                                          HorizontalOptions="Center"
                                                          VerticalOptions="Center">
                                        <Label Text="ðŸ–¨ï¸" FontSize="16" />
                                        <Label Text="Print" 
                                               FontFamily="AlegreyaBold"
                                               FontSize="14" 
                                               TextColor="{StaticResource Foreground}" />
                                    </HorizontalStackLayout>
                                    
                                    <!-- Action Buttons -->
                                    <StackLayout Grid.Column="8" 
                                                 Orientation="Horizontal" 
                                                 Spacing="6"
                                                 HorizontalOptions="Center"
                                                 VerticalOptions="Center">
                                        <Button Text="ðŸ‘" 
                                                BackgroundColor="{StaticResource Muted}" 
                                                TextColor="White"
                                                FontFamily="AlegreyaBold"
                                                FontSize="14"
                                                Padding="10,6"
                                                CornerRadius="6"
                                                Clicked="OnViewDetailsClicked"
                                                CommandParameter="{Binding .}" />
                                        <Button Text="ðŸ–¨" 
                                                BackgroundColor="{StaticResource Primary}" 
                                                TextColor="White"
                                                FontFamily="AlegreyaBold"
                                                FontSize="14"
                                                Padding="10,6"
                                                CornerRadius="6"
                                                Clicked="OnPrintReceiptClicked"
                                                CommandParameter="{Binding .}" />
                                    </StackLayout>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- No Orders Message - Elegant Design -->
                    <Border x:Name="NoOrdersFrame" 
                            BackgroundColor="{StaticResource Blue50}"
                            StrokeThickness="1"
                            Stroke="{StaticResource Blue200}"
                            Padding="60,50"
                            Margin="0,20,0,20"
                            IsVisible="False">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <StackLayout HorizontalOptions="Center" Spacing="12">
                            <Label Text="No Web Orders Found" 
                                   FontFamily="AlegreyaBold"
                                   FontSize="24" 
                                   TextColor="{StaticResource Blue700}"
                                   HorizontalOptions="Center" />
                            <Label Text="No web orders match your current filters." 
                                   FontFamily="AlegreyaRegular"
                                   FontSize="16" 
                                   TextColor="{StaticResource Blue600}" 
                                   HorizontalOptions="Center" />
                        </StackLayout>
                    </Border>
                </StackLayout>

                <!-- Loading Indicator -->
                <ActivityIndicator x:Name="LoadingIndicator" 
                                   IsRunning="False" 
                                   IsVisible="False" 
                                   Color="#007bff" 
                                   VerticalOptions="Center" 
                                   HorizontalOptions="Center" />

            </StackLayout>
        </ScrollView>

        <!-- Pagination Section at Bottom -->
        <Frame x:Name="FiltersSection" 
               Grid.Row="2"
               BackgroundColor="White" 
               Padding="20,15"
               Margin="0"
               CornerRadius="0"
               HasShadow="False"
               IsVisible="False">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Pagination Info -->
                <StackLayout Grid.Column="0" Orientation="Horizontal" VerticalOptions="Center">
                    <Label x:Name="PaginationLabel" 
                           Text="No orders" 
                           FontFamily="AlegreyaBold"
                           FontSize="15" 
                           TextColor="{StaticResource Foreground}"
                           VerticalOptions="Center" 
                           Margin="0,0,20,0" />
                    <Button x:Name="PrevPageButton" 
                            Text="â—€ Previous" 
                            BackgroundColor="{StaticResource Primary}" 
                            TextColor="White"
                            FontFamily="AlegreyaBold"
                            FontSize="14"
                            Padding="20,12"
                            CornerRadius="8"
                            Clicked="OnPreviousPageClicked" 
                            Margin="0,0,10,0"
                            HeightRequest="45" />
                    <Button x:Name="NextPageButton" 
                            Text="Next â–¶" 
                            BackgroundColor="{StaticResource Primary}" 
                            TextColor="White"
                            FontFamily="AlegreyaBold"
                            FontSize="14"
                            Padding="20,12"
                            CornerRadius="8"
                            Clicked="OnNextPageClicked"
                            HeightRequest="45" />
                </StackLayout>

                <!-- Right side controls: Refresh + Sync + Connection -->
                <HorizontalStackLayout Grid.Column="1" Spacing="12" VerticalOptions="Center">
                    <Button Text="Refresh" 
                            BackgroundColor="#10b981"
                            TextColor="White"
                            FontFamily="AlegreyaBold"
                            FontSize="15"
                            Padding="20,10"
                            CornerRadius="8"
                            HeightRequest="45"
                            Clicked="OnRefreshClicked" />

                    <!-- Sync Now -->
                    <Button x:Name="SyncNowButton"
                            Text="Sync Now"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            FontFamily="AlegreyaBold"
                            FontSize="13"
                            Padding="16,8"
                            CornerRadius="8"
                            HeightRequest="40"
                            Clicked="OnSyncNowClicked" />

                    <!-- Connection Status -->
                    <Frame BackgroundColor="{StaticResource Blue50}" 
                           Padding="10,8"
                           CornerRadius="8"
                           HasShadow="False"
                           BorderColor="{StaticResource Blue200}"
                           VerticalOptions="Center">
                        <StackLayout Spacing="2">
                            <StackLayout Orientation="Horizontal" Spacing="6">
                                <Ellipse x:Name="ConnectionStatusIndicator" 
                                         WidthRequest="8" 
                                         HeightRequest="8" 
                                         Fill="{StaticResource Green500}"
                                         VerticalOptions="Center" />
                                <Label x:Name="ConnectionStatusLabel" 
                                       Text="Connected" 
                                       FontFamily="AlegreyaBold"
                                       FontSize="12"
                                       TextColor="{StaticResource Blue900}"
                                       VerticalOptions="Center" />
                            </StackLayout>
                            <Label x:Name="LastSyncLabel" 
                                   Text="Last sync: Just now" 
                                   FontFamily="AlegreyaRegular"
                                   FontSize="10"
                                   TextColor="{StaticResource Blue600}" />
                        </StackLayout>
                    </Frame>
                </HorizontalStackLayout>
            </Grid>
        </Frame>

    </Grid>
    </Grid>

</ContentPage>