<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:views="clr-namespace:POS_in_NET.Views"
             x:Class="POS_in_NET.Pages.LiveOrderPage"
             Title=""
             BackgroundColor="{StaticResource Background}">

    <Grid RowDefinitions="Auto,Auto,*">
        
        <!-- Top Bar -->
        <views:TopBar x:Name="TopBar" Grid.Row="0"/>
        
        <!-- Tab Bar -->
        <Frame Grid.Row="1" 
               BackgroundColor="White"
               Padding="0"
               CornerRadius="0"
               HasShadow="False"
               BorderColor="#E5E7EB">
            <HorizontalStackLayout Spacing="12" HorizontalOptions="Center" Padding="24,16">
                
                <!-- Collection Tab -->
                <Border x:Name="CollectionTabBorder"
                        BackgroundColor="#F5F5F5"
                        StrokeThickness="0"
                        Padding="32,14"
                        HeightRequest="50">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCollectionTabClicked"/>
                    </Border.GestureRecognizers>
                    <Label x:Name="CollectionTabLabel"
                           Text="Collection" 
                           TextColor="#6B7280"
                           FontSize="15"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>
                </Border>

                <!-- Delivery Tab -->
                <Border x:Name="DeliveryTabBorder"
                        BackgroundColor="#F5F5F5"
                        StrokeThickness="0"
                        Padding="32,14"
                        HeightRequest="50">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnDeliveryTabClicked"/>
                    </Border.GestureRecognizers>
                    <Label x:Name="DeliveryTabLabel"
                           Text="Delivery" 
                           TextColor="#6B7280"
                           FontSize="15"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>
                </Border>

                <!-- Table Tab -->
                <Border x:Name="TableTabBorder"
                        BackgroundColor="#10B981"
                        StrokeThickness="0"
                        Padding="32,14"
                        HeightRequest="50">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8"/>
                    </Border.StrokeShape>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnTableTabClicked"/>
                    </Border.GestureRecognizers>
                    <Label x:Name="TableTabLabel"
                           Text="Table" 
                           TextColor="White"
                           FontSize="15"
                           FontAttributes="Bold"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>
                </Border>

            </HorizontalStackLayout>
        </Frame>

        <!-- Content Area -->
        <ScrollView Grid.Row="2">
            <VerticalStackLayout Padding="24" Spacing="16">
                
                <!-- Collection Orders -->
                <VerticalStackLayout x:Name="CollectionOrdersLayout" IsVisible="False" Spacing="12">
                    <CollectionView x:Name="CollectionOrdersCollection"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="White"
                                        StrokeThickness="2"
                                        Stroke="#E2E8F0"
                                        Padding="20"
                                        Margin="0,0,0,12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12"/>
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnOrderTapped"/>
                                    </Border.GestureRecognizers>
                                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="16">
                                        <!-- Order Info -->
                                        <VerticalStackLayout Grid.Column="0" Spacing="6">
                                            <Label Text="{Binding OrderNumber}" 
                                                   FontSize="18" 
                                                   FontAttributes="Bold"
                                                   TextColor="#1A202C"/>
                                            <Label Text="{Binding CustomerName}" 
                                                   FontSize="15"
                                                   TextColor="#4A5568"/>
                                            <Label Text="{Binding CreatedAt, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                                   FontSize="13"
                                                   TextColor="#718096"/>
                                        </VerticalStackLayout>
                                        
                                        <!-- Amount -->
                                        <Label Grid.Column="1"
                                               Text="{Binding TotalAmount, StringFormat='£{0:F2}'}" 
                                               FontSize="20" 
                                               FontAttributes="Bold"
                                               TextColor="#10B981"
                                               VerticalOptions="Center"/>
                                        
                                        <!-- Arrow -->
                                        <Label Grid.Column="2"
                                               Text="→"
                                               FontSize="24"
                                               TextColor="#3B82F6"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    
                    <!-- Empty State -->
                    <Label x:Name="CollectionEmptyLabel"
                           Text="No unpaid collection orders"
                           FontSize="16"
                           TextColor="#9CA3AF"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Margin="0,40,0,0"/>
                </VerticalStackLayout>

                <!-- Delivery Orders -->
                <VerticalStackLayout x:Name="DeliveryOrdersLayout" IsVisible="False" Spacing="12">
                    <CollectionView x:Name="DeliveryOrdersCollection"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="White"
                                        StrokeThickness="2"
                                        Stroke="#E2E8F0"
                                        Padding="20"
                                        Margin="0,0,0,12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12"/>
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnOrderTapped"/>
                                    </Border.GestureRecognizers>
                                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="16">
                                        <!-- Order Info -->
                                        <VerticalStackLayout Grid.Column="0" Spacing="6">
                                            <Label Text="{Binding OrderNumber}" 
                                                   FontSize="18" 
                                                   FontAttributes="Bold"
                                                   TextColor="#1A202C"/>
                                            <Label Text="{Binding CustomerName}" 
                                                   FontSize="15"
                                                   TextColor="#4A5568"/>
                                            <Label Text="{Binding CreatedAt, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                                   FontSize="13"
                                                   TextColor="#718096"/>
                                        </VerticalStackLayout>
                                        
                                        <!-- Amount -->
                                        <Label Grid.Column="1"
                                               Text="{Binding TotalAmount, StringFormat='£{0:F2}'}" 
                                               FontSize="20" 
                                               FontAttributes="Bold"
                                               TextColor="#10B981"
                                               VerticalOptions="Center"/>
                                        
                                        <!-- Arrow -->
                                        <Label Grid.Column="2"
                                               Text="→"
                                               FontSize="24"
                                               TextColor="#3B82F6"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    
                    <!-- Empty State -->
                    <Label x:Name="DeliveryEmptyLabel"
                           Text="No unpaid delivery orders"
                           FontSize="16"
                           TextColor="#9CA3AF"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Margin="0,40,0,0"/>
                </VerticalStackLayout>

                <!-- Table Orders -->
                <VerticalStackLayout x:Name="TableOrdersLayout" IsVisible="True" Spacing="12">
                    <CollectionView x:Name="TableOrdersCollection"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border BackgroundColor="White"
                                        StrokeThickness="2"
                                        Stroke="#E2E8F0"
                                        Padding="20"
                                        Margin="0,0,0,12">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="12"/>
                                    </Border.StrokeShape>
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer Tapped="OnTableTapped"/>
                                    </Border.GestureRecognizers>
                                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="16">
                                        <!-- Table Info -->
                                        <VerticalStackLayout Grid.Column="0" Spacing="6">
                                            <Label Text="{Binding TableName}" 
                                                   FontSize="18" 
                                                   FontAttributes="Bold"
                                                   TextColor="#1A202C"/>
                                            <Label Text="{Binding GuestCount, StringFormat='{0} Guests'}" 
                                                   FontSize="15"
                                                   TextColor="#4A5568"/>
                                            <Label Text="{Binding StartTime, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                                                   FontSize="13"
                                                   TextColor="#718096"/>
                                        </VerticalStackLayout>
                                        
                                        <!-- Amount -->
                                        <Label Grid.Column="1"
                                               Text="{Binding TotalAmount, StringFormat='£{0:F2}'}" 
                                               FontSize="20" 
                                               FontAttributes="Bold"
                                               TextColor="#10B981"
                                               VerticalOptions="Center"/>
                                        
                                        <!-- Arrow -->
                                        <Label Grid.Column="2"
                                               Text="→"
                                               FontSize="24"
                                               TextColor="#3B82F6"
                                               VerticalOptions="Center"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    
                    <!-- Empty State -->
                    <Label x:Name="TableEmptyLabel"
                           Text="No active table sessions"
                           FontSize="16"
                           TextColor="#9CA3AF"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"
                           Margin="0,40,0,0"/>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

    </Grid>
</ContentPage>
